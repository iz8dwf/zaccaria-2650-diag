 AS V1.42 Beta [Bld 230] - Source File diag_awshell.asm - Page 1 - 11/12/2025 09:00:40 PM


       1/       0 :                     ; Diagnostic 1Kbytes ROM for Zaccaria Astro War arcade PCB
       2/       0 :                     ; this code only tests the "shell" (alien's bombs) RAM and
       3/       0 :                     ; display circuitry.
       4/       0 :                     ; IZ8DWF 2022 - 2025
       5/       0 :                     ; rev. 0.3
       6/       0 :                     	
       7/       0 :                     ; This code needs to go in position 8H (mapped at 0000H)
       8/       0 :                     ; the other ROMs are mapped as follows:
       9/       0 :                     ; 10H @ 0400H
      10/       0 :                     ; 11H @ 0800H
      11/       0 :                     ; 13H @ 0C00H
      12/       0 :                     ; 8I  @ 1000H
      13/       0 :                     ; 10I @ 2000H
      14/       0 :                     ; 11I @ 2400H
      15/       0 :                     ; 13I @ 2800H
      16/       0 :                     ; 11L @ 2C00H
      17/       0 :                     ; 13L @ 3000H
      18/       0 :                     
      19/       0 :                     ; Memory mapped stuff other than ROMs:
      20/       0 :                     ;
      21/       0 :                     ; Program RAM        	1400H - 14FFH  (low nibble 13F, high 13G)
      22/       0 :                     ; 2636 PVI 8F	      	1500H - 15FFH
      23/       0 :                     ; BG color RAM	      	1800H - 1BFFH with PSU FLAG = 0 (low nibble only 3C)
      24/       0 :                     ; BG (character) RAM  	1800H - 1BFFH with PSU FLAG = 1 (low nibble 2C, high 1C)
      25/       0 :                     ; Shell (bombs) RAM 	1C00H - 1CFFH (low nibble 3F, high 2F)
      26/       0 :                     
      27/       0 :                     ; I/O read map:
      28/       0 :                     ;
      29/       0 :                     ; redd - clears collision detection 
      30/       0 :                     ; redc - reads collision detection @ 7L
      31/       0 :                     ; etxended: (bits 0 to 5 valid only)
      32/       0 :                     ; 0H = inputs 0 
      33/       0 :                     ; 2H = inputs 1 
      34/       0 :                     ; 6H = DIP switches @ 3N
      35/       0 :                     ; 7H = DIP switches @ 2N
      36/       0 :                     
      37/       0 :                     ; I/O write map:
      38/       0 :                     ;
      39/       0 :                     ; wrtd - sounds (3L latch, bits 0 to 5)
      40/       0 :                     ; wrtc - latch at 2L 
      41/       0 :                     ;	 bit 5 = STON (starfield enable)
      42/       0 :                     ;        bit 4 = sound 8
      43/       0 :                     ;        bit 3 = sound 7
      44/       0 :                     ;        bit 2,1,0 = transitor bases (coin counters)
      45/       0 :                     ; extended -> DO NOT USE 
      46/       0 :                     
      47/       0 :                     ; The first 32 bytes on the BG ram aren't displayed, so we can use them as general purpose
      48/       0 :                     ; RAM: 1800H to 181FH 
      49/       0 :                     ; It also seems that only 29 chars of each row are actually displayed
      50/       0 :                     ; "first" row of text begins at 1BE0H, second at 1BE1H etc..
      51/       0 :                     
      52/       0 :                     	relaxed on
      53/       0 :                     	page 	0
      54/       0 :                     	cpu	2650
      55/       0 :                     	org 	0
      56/       0 :                     
      57/       0 :                     reset:
      58/       0 : 04 20               	lodi,r0 H'20'	; mask to disable interrupts
      59/       2 : 92                  	lpsu		; disables interrupts 
      60/       3 : 20                  	eorz r0		; r0 XOR r0 = clears the register  
      61/       4 : 93                  	lpsl		; clears status low
      62/       5 : 77 02               	ppsl H'02'	; set to unsigned logic compare
      63/       7 : C1                  	strz r1		; clears r1
      64/       8 :                     
      65/       8 :                     
      66/       8 :                     ; clears the sprites of PVI
      67/       8 :                     
      68/       8 : CD 75 00            clrpvi:	stra,r0 H'1500',r1
      69/       B : D9 7B               	birr,r1 clrpvi
      70/       D :                     
      71/       D :                     
      72/       D :                     ; clears "background" RAM
      73/       D :                     
      74/       D : 74 40               	cpsu H'40'		; to access the color ram, flag must be 0
      75/       F : 04 01               	lodi,r0 H'01'
      76/      11 : 3F 00 55            	bsta,un fill
      77/      14 : 76 40               	ppsu H'40'		; to access the char ram, flag must be 1
      78/      16 : 04 F0               	lodi,r0 H'F0'
      79/      18 : 3F 00 55            	bsta,un fill
      80/      1B :                     
      81/      1B :                     ; makes a static diagonal "shell" pattern
      82/      1B :                     
      83/      1B : 20                  diagn:	eorz,r0
      84/      1C : 01                  	lodz,r1
      85/      1D : CC 7C 00            fixsh:	stra,r0 H'1C00',r0
      86/      20 : D8 7B               	birr,r0 fixsh
      87/      22 : 3F 00 86            	bsta,un wfinp		; wait for player 1 pressed
      88/      25 : 1B 21               	bctr,un vsync
      89/      27 :                     
      90/      27 :                     ; the following makes a shifting pattern
      91/      27 : 20                  	eorz,r0
      92/      28 : 01                  	lodz,r1
      93/      29 : 03                  	lodz,r3
      94/      2A : B4 80               vsy:	tpsu H'80'		; attempt to start in the vertical retrace
      95/      2C : 98 7C               	bcfr,eq vsy
      96/      2E : CD 3C 00            	stra,r0 H'1C00',r1,+
      97/      31 : D8 77               	birr,r0 vsy
      98/      33 : 85 01               	addi,r1 H'01'
      99/      35 : 3F 00 76            chk:	bsta,un inpck		; checks P1 and fire buttons
     100/      38 : E7 00               	comi,r3 H'00'
     101/      3A : 18 6E               	bctr,eq vsy		; seems P1 wasn't pressed
     102/      3C : E7 01               	comi,r3 H'01'
     103/      3E : 18 08               	bctr,eq vsync
     104/      40 : E7 02               	comi,r3 H'02'
     105/      42 : 18 57               	bctr,eq diagn
     106/      44 : 07 00               	lodi,r3 H'00'
     107/      46 : 1B 62               	bctr,un vsy
     108/      48 :                     
     109/      48 :                     ; the following makes a straight pattern
     110/      48 : B4 80               vsync:	tpsu H'80'		; attempt to start in the vertical retrace
     111/      4A : 98 7C               	bcfr,eq vsync
     112/      4C : CD 7C 00            	stra,r0 H'1C00',r1
     113/      4F : D9 77               	birr,r1 vsync
     114/      51 : 84 01               	addi,r0 H'01'
     115/      53 :                     ;	bctr,un chk
     116/      53 : 1B 73               	bctr,un vsync
     117/      55 :                     
     118/      55 :                     ; subroutines
     119/      55 :                     
     120/      55 : CD 38 00            fill:	stra,r0 H'1800',r1,+
     121/      58 : CD 79 00            	stra,r0 H'1900',r1
     122/      5B : CD 7A 00            	stra,r0 H'1A00',r1
     123/      5E : CD 7B 00            	stra,r0 H'1B00',r1
     124/      61 : 59 72               	brnr,r1 fill
     125/      63 : 17                  	retc,un
     126/      64 :                     
     127/      64 :                     
     128/      64 :                     hexadj:
     129/      64 : 44 0F               	andi,r0 H'0F'
     130/      66 : 84 60               	addi,r0 H'60'
     131/      68 : E4 6A               	comi,r0 H'6A'
     132/      6A : 1A 02               	bctr,lt stlow
     133/      6C : A4 29               	subi,r0 H'29'
     134/      6E : 17                  stlow:	retc,un
     135/      6F :                     
     136/      6F : 50                  rot0:	rrr,r0
     137/      70 : 50                  	rrr,r0
     138/      71 : 50                  	rrr,r0
     139/      72 : 50                  	rrr,r0
     140/      73 : 3B 6F               	bstr,un hexadj
     141/      75 : 17                  	retc,un
     142/      76 :                     
     143/      76 : 56 00               inpck:	rede,r2 H'00'		; read input col. 0
     144/      78 : 46 01               	andi,r2 H'01'		; mask bit 0 (player 1)
     145/      7A : 98 03               	bcfr,eq fire		; not pressed, next check fire
     146/      7C : 87 01               	addi,r3 H'01'		; if pressed P1 then increment r3
     147/      7E : 17                  	retc,un			; and return
     148/      7F : 56 00               fire:	rede,r2 H'00'		; read input col. 0
     149/      81 : 46 20               	andi,r2 H'20'		; mask bit 5 (fire)
     150/      83 : 18 7A               	bctr,eq fire		; if is pressed, we wait
     151/      85 : 17                  	retc,un
     152/      86 :                     wfinp:
     153/      86 : 56 00               	rede,r2 H'00'		; read input col. 0
     154/      88 : 46 01               	andi,r2 H'01'		; mask bit 0 (player 1)
     155/      8A : 98 7A               	bcfr,eq wfinp		; if is NOT pressed, we wait
     156/      8C : 56 00               wfrl:	rede,r2 H'00'
     157/      8E : 46 01               	andi,r2 H'01'		
     158/      90 : 18 7A               	bctr,eq wfrl		; wait for release
     159/      92 : 17                  	retc,un
     160/      93 :                     
     161/      93 :                     
     162/      93 :                     
     163/      93 :                     ; not all letters are available! 
     164/      93 :                     ; space is 3Fh
     165/      93 :                     ; numbers start at 60h
     166/      93 :                     
     167/      93 : 47 41 4C 41 3F 44   welc:	db "GALA",H'3F',"DIAG",H'3F',H'68',"DWF\0"
               99 : 49 41 47 3F 68 44 
               9F : 57 46 00          
     168/      A2 : 52 41 4D 00         ram:	db "RAM\0"
     169/      A6 : 52 4F 4D 00         rom:	db "ROM\0"
     170/      AA : 43 50 3F 00         cpu:	db "CP",H'3F',H'00'
     171/      AE : 3F 43 4C 3F 00      cll:	db H'3F',"CL",H'3F',H'00'
     172/      B3 : 42 47 3F 00         bg:	db "BG",H'3F',H'00'
     173/      B7 : 43 4F 3F 00         col:	db "CO",H'3F',H'00'
     174/      BB : 53 48 3F 00         shel:	db "SH",H'3F',H'00'
     175/      BF : 3F 47 44 00         ok:	db H'3F',"GD",H'00'
     176/      C3 : 3F 42 3F 00         bits:	db H'3F',"B",H'3F',H'00'
     177/      C7 : 3F 4F 3F 00         offs:	db H'3F',"O",H'3F',H'00'
     178/      CB : 61 60 48 00         tenh:	db H'61',H'60',"H\0"
     179/      CF : 61 61 48 00         eleh:	db H'61',H'61',"H\0"
     180/      D3 : 61 63 48 00         thih:	db H'61',H'63',"H\0"
     181/      D7 : 68 49 00            eigi:	db H'68',"I\0"
     182/      DA : 61 60 49 00         teni:	db H'61',H'60',"I\0"
     183/      DE : 61 61 49 00         elei:	db H'61',H'61',"I\0"
     184/      E2 : 61 63 49 00         thii:	db H'61',H'63',"I\0"
     185/      E6 : 61 61 4C 00         elel:	db H'61',H'61',"L\0"
     186/      EA : 61 63 4C 00         thil:	db H'61',H'63',"L\0"
     187/      EE :                     
 AS V1.42 Beta [Bld 230] - Source File diag_awshell.asm - Page 2 - 11/12/2025 09:00:40 PM


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BG :                            B3 C | *BITS :                          C3 C |
*CASESENSITIVE :                  0 - | *CHK :                           35 C |
*CLL :                           AE C |  CLRPVI :                         8 C |
*COL :                           B7 C | *COMPMODE :                       0 - |
*CONSTPI :        3.141592653589793 - | *CPU :                           AA C |
*DATE :                "11/12/2025" - |  DIAGN :                         1B C |
*EIGI :                          D7 C | *ELEH :                          CF C |
*ELEI :                          DE C | *ELEL :                          E6 C |
*FALSE :                          0 - |  FILL :                          55 C |
 FIRE :                          7F C |  FIXSH :                         1D C |
*HAS64 :                          1 - |  HEXADJ :                        64 C |
 INPCK :                         76 C | *LISTON :                         1 - |
*MACEXP :                         7 - | *MOMCPU :                      2650 - |
*MOMCPUNAME :                "2650" - | *NESTMAX :                      100 - |
*OFFS :                          C7 C | *OK :                            BF C |
*RAM :                           A2 C | *RELAXED :                        1 - |
*RESET :                          0 C | *ROM :                           A6 C |
*ROT0 :                          6F C | *SHEL :                          BB C |
 STLOW :                         6E C | *TENH :                          CB C |
*TENI :                          DA C | *THIH :                          D3 C |
*THII :                          E2 C | *THIL :                          EA C |
*TIME :               "09:00:40 PM" - | *TRUE :                           1 - |
*VERSION :                     142F - |  VSY :                           2A C |
 VSYNC :                         48 C | *WELC :                          93 C |
 WFINP :                         86 C |  WFRL :                          8C C |

     51 symbols
     39 unused symbols

 AS V1.42 Beta [Bld 230] - Source File diag_awshell.asm - Page 3 - 11/12/2025 09:00:40 PM


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.00 seconds assembly time

    187 lines source file
      2 passes
      0 errors
      0 warnings
